# 서버 설정 블록
server {
    # 포트 80에서 HTTP 요청 수신
    listen 80;
    
    # 모든 도메인 허용 (_ = 와일드카드)
    server_name _;

    # 정적 파일 루트 경로 (빌드된 React 파일)
    root /usr/share/nginx/html;
    
    # 기본 인덱스 파일
    index index.html;

    # ==========================================
    # 1️⃣ SPA 라우팅 설정 
    # ==========================================
    location / {
        # $uri: 요청한 경로
        # $uri/: 폴더로 시도
        # /index.html: 없으면 index.html로 리다이렉트
        # 예: /home 요청 → /index.html 반환 → React Router가 처리
        try_files $uri $uri/ /index.html;
    }

    # ==========================================
    # 2️⃣ API 백엔드 프록시
    # ==========================================
    location /api/ {
        # API 요청을 백엔드 서버로 전달
        proxy_pass https://reservation-calendar-ek60.onrender.com/;
        
        # 클라이언트 요청 헤더 전달
        proxy_set_header Host $host;                    # 원본 호스트
        proxy_set_header X-Real-IP $remote_addr;        # 클라이언트 실제 IP
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;  # 프록시 거친 IP들
        proxy_set_header X-Forwarded-Proto $scheme;     # HTTP or HTTPS
    }

    # ==========================================
    # 3️⃣ 정적 파일 캐싱
    # ==========================================
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$ {
        # 1년간 캐시 유지
        expires 1y;
        
        # 캐시 제어 헤더
        # public: 모든 캐시가 저장 가능
        # immutable: 절대 변경되지 않음 (브라우저 캐시 활용)
        add_header Cache-Control "public, immutable";
    }
}